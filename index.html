<html>
    <head>
        <!-- jQuery 3.3.1 -->
        <script src="/local_modules/jquery/jquery-3.3.1.min.js"></script>
        
        <!-- Bootstrap -->
        <script src="/local_modules/bootstrap-4.0.0/dist/js/bootstrap.min.js"></script>

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="/local_modules/bootstrap-4.0.0/dist/css/bootstrap.min.css">

        <!-- Bootstrap Optional theme -->
        <!-- <link rel="stylesheet" href="/local_modules/bootstrap-3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
        
        <!-- my stylesheet -->
        <link rel="stylesheet" href="/main.css">

        <!-- Cabin font -->
        <link href="https://fonts.googleapis.com/css?family=Cabin" rel="stylesheet">  
    </head>

    <body>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-sm bg-light navbar-light fixed-top">
            <a class="navbar-brand" href="/">Drew Graham</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-item nav-link active" href="/">Home <span class="sr-only">(current)</span></a>
                    <a class="nav-item nav-link" href="/games">Games</a>
                    <a class="nav-item nav-link" href="/about">About</a>
                    <a class="nav-item nav-link disabled" href="#">Blog (coming soon)</a>
                </div>
            </div>
        </nav>

        <div class="container">
            
            <br>
            <!-- page header -->
            <div class="jumbotron">
                <div class="row">
                    <div class="col-xs-6">
                        <h1 class="text-center">Drew Graham</h1>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-6">
                        <p class="text-right">Hi, I make games and talk about games.</p>
                    </div>
                </div>
            </div>

            <!-- games grid -->
            <h3>Recent Games</h3></br>
            <div class="row" id="game-grid">
                

                <!-- thumbnail links to game go here -->

            </div>

            
            <!-- create link to remaning games if game grid overflows past 3 -->
            <div class="row" id="see-more">
            </div>

            <div class="row" id="posts">
                <!-- TODO: fill this section with posts i've written in posts.json -->
            </div>

            
        </div>
    </body>

  <script type="text/javascript">
    GetGames();

    // Gets list of games from server and passes it to FillGameGrid()
    function GetGames() {

        $.ajax({
                type: "GET",
                url: "./getGames",
                dataType: "json",
                
                success: function(msg){
                    // parse response into json
                    console.log("games returned from server: " + Object.keys(msg));

                    // fill game grid wtih links to these games
                    FillGameGrid(msg);
                }
            });

    }
    
    // Fills game grid with thumbnails with links to games returned from server
    function FillGameGrid(games) {
      if(games == null) {
          console.log("ERROR: returned list of games is null");
      }
      else {
          console.log(games);

          // iterate through list of game ids
          //for(var gameId in games) {
            for(var i = 0; i < Object.keys(games).length; i++) {

                // Create "See More..." link to view games if count is beyond 3
                if(i >= 3) {
                    console.log("creating link to view full list of games");
                    $("<h4> <a href=\"/games\">See More...</a> </div> </h4>").appendTo("#see-more");
                    return;
                }

                // Get game id from object
                var gameId = Object.keys(games)[i];
                
                // Get game name, thumbnail image, and short description (used as caption)
                var name = games[gameId].name;
                var thumbnail = games[gameId].thumbnail;
                var shortDescription = games[gameId].shortDescription;

                // Create card for game
                $("<div class=\"col-md-4\">" +
                    "<div class=\"card\" style=\"width: 18rem;\">" +
                        "<a href=\"/game?gameId=" + gameId + "\">" +
                            "<img src=\"" + thumbnail +  "\" class=\"img-rounded\" alt=\"Lights\" style=\"width:100%\">" +
                        "</a>" +
                        "<div class=\"card-body\">" +
                            "<h4 class=\"card-title\">" + name + "</h4>" +
                            "<p class=\"card-text\">" + shortDescription + "</p>" +
                        "</div>" +
                    "</div>" +
                "</div>")
                .appendTo("#game-grid");
            }
      }
    }
    
  </script>
  

</html>
