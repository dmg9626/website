<html>
    <head>
        <!-- jQuery 3.3.1 -->
        <script src="/local_modules/jquery/jquery-3.3.1.min.js"integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        
        <!-- Bootstrap -->
        <script src="/local_modules/bootstrap-3.3.7/js/bootstrap.min.js"></script>

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="/local_modules/bootstrap-3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Bootstrap Optional theme -->
        <link rel="stylesheet" href="/local_modules/bootstrap-3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        
        <!-- my stylesheet -->
        <link rel="stylesheet" href="/main.css">

        <!-- Cabin font -->
        <link href="https://fonts.googleapis.com/css?family=Cabin" rel="stylesheet">  
    </head>

    <body>
        <!-- Navbar -->
        <div class="navbar navbar-default">
                <div class="navbar-header"><a class="navbar-brand" href="/">Drew Graham</a>
                    <a class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="/">Home</a></li>
                        <li><a href="/games">Games</a></li>
                        <li><a href="/about">About</a></li>
                    </ul>
                </div>
            </div>

        <div class="container">

            <!-- page header -->
            <div class="jumbotron">
                <div class="row">

                    <div class="col-xs-12">
                        <h1>Drew Graham</h1>
                        <h5>Hi, I make games and talk about games.</h5>
                    </div>
                    
                    <div class="col-xs-12">
                        <h6>(I'm not a web developer)</h6>
                    </div>

                </div>
            </div>

            
            <!-- games grid -->
            <div class="row" id="game-grid">
                <h3>Recent Games</h3></br>

                <!-- thumbnail links to game go here -->

            </div>
            <!-- create link to remaning games if game grid overflows past 3 -->
            <div class="row" id="see-more">
            </div>

            <div class="row" id="posts">
                <!-- TODO: fill this section with posts i've written in posts.json -->
            </div>

            
        </div>
    </body>

  <script type="text/javascript">
    GetGames();

    // Gets list of games from server and passes it to FillGameGrid()
    function GetGames() {

        $.ajax({
                type: "GET",
                url: "./getGames",
                dataType: "json",
                
                success: function(msg){
                    // parse response into json
                    console.log("games returned from server: " + Object.keys(msg));

                    // fill game grid wtih links to these games
                    FillGameGrid(msg);
                }
            });

    }
    
    // Fills game grid with thumbnails with links to games returned from server
    function FillGameGrid(games) {
      if(games == null) {
          console.log("ERROR: returned list of games is null");
      }
      else {
          console.log(games);

          // iterate through list of game ids
          //for(var gameId in games) {
            for(var i = 0; i < Object.keys(games).length; i++) {

                // Create "See More..." link to view games if count is beyond 3
                if(i >= 3) {
                    console.log("creating link to view full list of games");
                    $("#see-more").append("<h4> <a href=\"/games\">See More...</a> </div> </h4>");
                    return;
                }

                // Get game id from object
                var gameId = Object.keys(games)[i];
                
                // Get name and thumbnail image path
                var name = games[gameId].name;

                // Route path through games/ folder
                var thumbnail = games[gameId].thumbnail;

                // Create thumbnail link
                console.log("creating link for game: " + name);
                $("#game-grid").append("<div class=\"col-md-4\">" +
                    "<div class=\"thumbnail\">" +
                        "<a href=\"/game?gameId=" + gameId + "\">" +
                            "<img src=\"" + thumbnail +  "\" alt=\"Lights\" style=\"width:100%\">" +
                            "<div class=\"caption\">" +
                                "<p>" + name + "</p>" +
                            "</div>" +
                        "</a>" +
                    "</div>" +
                "</div>");
          }
      }
    }
  </script>
  

</html>
