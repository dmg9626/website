<html>
    <head>
        <!-- jQuery 3.3.1 -->
        <script src="/local_modules/jquery/jquery-3.3.1.min.js"></script>
        
        <!-- Bootstrap 4.0 -->
        <!-- <script src="/local_modules/bootstrap-4.0.0/dist/js/bootstrap.min.js"></script> -->

        <!-- Bootstrap 4.0 CSS -->
        <!-- <link rel="stylesheet" href="/local_modules/bootstrap-4.0.0/dist/css/bootstrap.min.css"> -->

        <!-- Bootstrap 3.0 -->
        <link rel="stylesheet" href="/local_modules/bootstrap-3.3.7/js/bootstrap.min.js">

        <!-- Bootstrap 3.0 CSS-->
        <link rel="stylesheet" href="/local_modules/bootstrap-3.3.7/css/bootstrap.min.css">

        <!-- Bootstrap 3.3.7 Optional theme -->
        <!-- <link rel="stylesheet" href="/local_modules/bootstrap-3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
        
        <!-- my stylesheet -->
        <link rel="stylesheet" href="/main.css">

        <!-- Cabin font -->
        <link href="https://fonts.googleapis.com/css?family=Cabin" rel="stylesheet">  
    </head>
    
    <body>
        
        <!-- Navbar (3.3.7) -->
        <div class="navbar navbar-default">
            <div class="navbar-header"><a class="navbar-brand" href="/">Drew Graham</a>
                <a class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li class="active"><a href="/games">Games</a></li>
                    <li><a href="/about">About</a></li>
                    <li class="disabled"><a>Blog (coming soon)</a></li>
                </ul>
            </div>
        </div>

        <!-- page body -->
        <div class="container">
            
            <!-- Navbar (4.0) -->
            <!-- <nav class="navbar navbar-expand-sm fixed-top bg-light navbar-light">
                <a class="navbar-brand" href="/">Drew Graham</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-item nav-link active" href="/">Home <span class="sr-only">(current)</span></a>
                        <a class="nav-item nav-link" href="/games">Games</a>
                        <a class="nav-item nav-link" href="/about">About</a>
                        <a class="nav-item nav-link disabled" href="#">Blog (coming soon)</a>
                    </div>
                </div>
            </nav> -->

            <!-- grid of thumbnails -->
            <div class="row" id="game-grid">
                <h3>My Games</h3></br>
                <!-- thumbnails go here -->
            </div>
        </div> <!-- end of page body -->
    </body>

    <script type="text/javascript">

        GetGames();

        // Gets list of games from server and passes it to FillGameGrid()
        function GetGames() {

            $.ajax({
                    type: "GET",
                    url: "/getGames",
                    dataType: "json",
                    
                    success: function(msg){
                        // parse response into json
                        console.log("games returned from server: " + Object.keys(msg));

                        // fill game grid wtih links to these games
                        FillGameGrid(msg);
                    }
                });

        }

        // Fills game grid with thumbnails with links to games returned from server
        function FillGameGrid(games) {
        if(games == null) {
            console.log("ERROR: returned list of games is null");
        }
        else {
            console.log(games);

            // Size of game card relative to Bootstrap's 12-grid system
            var colGridWidth = 3;

            // iterate through list of game ids
            //for(var gameId in games) {
                for(var i = 0; i < Object.keys(games).length; i++) {

                    // Get game id from object
                    var gameId = Object.keys(games)[i];

                    // Get game name, thumbnail image, and short description (used as caption)
                    var name = games[gameId].name;
                    var thumbnail = games[gameId].thumbnail;
                    var shortDescription = games[gameId].shortDescription;

                    // get row number
                    var rowNumber = Math.floor(i / (12 / colGridWidth));
                    // console.log(gameId + " row number: " + rowNumber);

                    // Create card for game
                    $("<div id=\"" + gameId + "\" class=\"col-md-" + colGridWidth + "\">" +
                        "<div class=\"card\">" +
                            "<a href=\"/game?gameId=" + gameId + "\">" +
                                "<img src=\"" + thumbnail +  "\" alt=\"Lights\" style=\"width:100%\">" +
                            "</a>" +
                            "<div class=\"card-body\">" +
                                "<h4 class=\"card-title\">" + name + "</h4>" +
                                "<p class=\"card text\">" + shortDescription + "</p>" +
                            "</div>" +
                        "</div>" +
                    "</div>")
                    .appendTo("#game-grid");



                    // Add line break if at end of row
                    var remainder = (i + 1) % (12 / colGridWidth);
                    // console.log(gameId + " remainder = (" + i + " + 1) % (12 / " + colGridWidth + ") = " + remainder);

                    if(remainder == 0) {
                        // Check if this is the last game in the list before adding new row
                        var endOfGamesList = (i + 1) >= Object.keys(games).length;
                        console.log(gameId + " end of games list: " + endOfGamesList);

                        if(!endOfGamesList) {
                            console.log("game " + gameId + " is multiple of " + (12 / colGridWidth) + ", adding line break");
                            
                            // add new row
                        }
                    }
                    
                }
            }
        }

        /*          new game card styling (TODO: implement this)

                    // Create card for game
                    $("#game-grid").append(
                    "<div class=\"col-md-3\">" +
                        "<div class=\"card\">" +
                            "<a href=\"/game?gameId=" + gameId + "\">" +
                                "<img src=\"" + thumbnail +  "\" alt=\"Lights\" style=\"width:100%\">" +
                            "</a>" +
                            "<div class=\"card-body\">" +
                                "<h4 class=\"card-title\">" + name + "</h4>" +
                                "<p class=\"card text\">" + shortDescription + "</p>" +
                            "</div>" +
                        "</div>" +
                    "</div>");
        */

    </script>
    
</html>