<html>
    <head>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    
        <!-- Bootstrap js -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <!-- jQuery 3.3.1 -->
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    
        <!-- my css -->
        <link rel="stylesheet" href="main.css">
    
        <!-- Cabin font -->
        <link href="https://fonts.googleapis.com/css?family=Cabin" rel="stylesheet">
    </head>
    
    <body>
        <!-- Navbar -->
        <div class="navbar navbar-default">
            <div class="navbar-header"><a class="navbar-brand" href="/">Drew Graham</a>
                <a class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/">Home</a></li>
                    <li><a href="/games">Games</a></li>
                </ul>
            </div>
        </div>

        <!-- page header -->
        <div class="container">
            <div class="jumbotron horizontal-center">
                <div class="row">
                    <div class="col-xs-12">
                        <h1 id="name"></h1>
                        <h3 id="shortDescription"></h3>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- page body -->
        <div class="container">

            <!-- cover image of game -->
            <div class="row" id="cover-image">
                <br/>
            </div>
            <br/>

            <!-- link to playable game -->
            <div class="row" id="game-link">
            </div>

        
            <!-- grid of thumbnail links to games -->
            <div class="row" id="thumbnail-grid">
                <!-- thumbnails go here -->
            </div>
            

            <!-- game description-->
            <div class="game-description">
                <div class="jumbotron">
                    <div class="game-description-text" id="description"></div>
                    <br>
                </div>
            </div>
          

        </div> <!-- end of page body -->
    </body>

    <script type="text/javascript">
        function GetGameData()
        {
            // get gameId from url query
            var urlParams = new URLSearchParams(window.location.search);
            var id = urlParams.get('gameId');
            if(id == null) {
                console.log("unable to get game data, parameter name not found");
                return;
            }
            console.log("getting data for game:" + id);

            $.ajax({
                type: "GET",
                url: "/getGameData",
                dataType: "text",
                data: {
                    gameId: id
                },
                
                success: function(msg){
                    // parse response into json
                    var json = JSON.parse(msg);
                    
                    if(json == null) {
                        console.log("could not parse response: " + msg);
                        return;
                    }
                    console.log(json);
                    
                    FillGameData(json);
                }
            });

        }

        GetGameData();
        
        // Fills divs with game data
        function FillGameData(json) {
            // get game data
            var name = json["name"];
            var description = json["description"];
            var shortDescription = json["shortDescription"];
            var coverImage = json["coverImage"];
            var playable = json["playable"];
            
            GenerateScreenshots(json);
            
            // Fill name
            $("#name").text(name);
            // Fill short description
            $("#shortDescription").text(shortDescription);
            // Fill cover image
            $("#cover-image").html("<img src=\"" + coverImage + "\" class=\"img-responsive center-block\">" + "<br/>");
            // // Fill description
            $("#description").html("<h2>Description</h2>");
            for(var item in description) {
                console.log("adding description " + item);

                // add description header (ignore for "main" item)
                if(item != "main" && item != "Github") {
                    $("#description").append("<h2>" + item + "</h2>");
                }
                
                // Github link
                if(item == "Github") {
                    $("#description").append("<h3>Github: <a href=\"" + description[item] + "\">" + description[item] + "</a></h3>");
                    continue;
                }
                // add description body
                $("#description").append("<p>" + description[item] + "</p><hr/>");
            }
            
            // Fill link to game if playable
            if(playable) {
                var link = json["link"];
                console.log("game is playable, adding link: " + link);
                $("#game-link").html(
                    "<h3>Play game "
                        + "<b><a href=\"" + link + "\">here!</a>"
                    +"</b></h3><hr>");
            }
            else {
                console.log("game not playable, hiding game-link section");
                $("#game-link").empty();
            }
            
        }


        // Generates screenshots from response on page
        function GenerateScreenshots(json) {
            console.log("generating screenshots");
            // get images from json
            var images = json["images"];
            console.log(images);

            // initialize thumbnail grid
            $("#thumbnail-grid").html("<h3>Screenshots</h3>");

            for(var imageKey in images) {
                // get image json object (contains image path and caption)
                var image = images[imageKey];
                
                // validate
                if(image == null) {
                    console.log("image object [" + imageKey + "] not found, continuing");
                    continue;
                }
                console.log("parsing image [" + imageKey + "]");

                // get image path and caption
                var imagePath = image["imagePath"];
                var caption = image["caption"];
                
                // validate
                if(imagePath == null || caption == null) {
                    console.log("Image could not be parsed: path (" + imagePath + "), caption (" + caption + ")");
                    continue;
                }

                $("#thumbnail-grid").append(
                    "<div class=\"col-md-4\">" +
                        "<div class=\"thumbnail\">" +
                            "<a href=\"" + imagePath + "\">" +
                                "<img src=\"" + imagePath + "\" alt=\"Lights\" style=\"width:100%\">" +
                                "<div class=\"caption\"><p>" + caption + "</p></div>" +
                            "</a>" +
                        "</div>" +
                    "</div>");
            }
        }

    </script>
    
</html>